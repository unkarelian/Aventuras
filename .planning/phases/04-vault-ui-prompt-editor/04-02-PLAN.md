---
phase: 04-vault-ui-prompt-editor
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/lib/components/vault/VaultPanel.svelte
  - src/lib/components/vault/prompts/PromptPackList.svelte
  - src/lib/components/vault/prompts/PromptPackCard.svelte
  - src/lib/components/vault/prompts/CreatePackDialog.svelte
autonomous: true

must_haves:
  truths:
    - "Vault has a Prompts tab alongside Characters, Lorebooks, and Scenarios"
    - "Prompts tab shows cards for each preset pack"
    - "Default pack card is pinned to top with a Default badge"
    - "Pack cards show name, description, modified template count, and active badge"
    - "Prompts tab has New and Import buttons in top right area"
    - "Import button is disabled with tooltip indicating Phase 5"
    - "User can create a new preset pack that copies defaults"
  artifacts:
    - path: "src/lib/components/vault/VaultPanel.svelte"
      provides: "Fourth tab integration"
      contains: "prompts"
    - path: "src/lib/components/vault/prompts/PromptPackList.svelte"
      provides: "Pack browsing view with card grid"
      contains: "PromptPackCard"
    - path: "src/lib/components/vault/prompts/PromptPackCard.svelte"
      provides: "Individual pack card with metadata display"
      contains: "modifiedCount"
    - path: "src/lib/components/vault/prompts/CreatePackDialog.svelte"
      provides: "New pack creation dialog"
      contains: "packService.createPack"
  key_links:
    - from: "src/lib/components/vault/VaultPanel.svelte"
      to: "src/lib/components/vault/prompts/PromptPackList.svelte"
      via: "TabsContent rendering"
      pattern: "PromptPackList"
    - from: "src/lib/components/vault/prompts/PromptPackCard.svelte"
      to: "src/lib/services/packs/pack-service.ts"
      via: "packService.getModifiedTemplates for modified count"
      pattern: "getModifiedTemplates"
    - from: "src/lib/components/vault/prompts/PromptPackCard.svelte"
      to: "src/lib/services/database.ts"
      via: "database.getPackUsageCount for active badge"
      pattern: "getPackUsageCount"
---

<objective>
Create the Prompts tab in the Vault with pack card browsing, New pack creation, and proper VaultPanel integration.

Purpose: This is the entry point for the entire prompt editor experience. Users see their preset packs, create new ones, and eventually click into the editor (next plan). The card design is distinct from existing vault cards per user decision.

Output: Working Prompts tab with pack cards showing metadata, New button, disabled Import placeholder, and create pack dialog.
</objective>

<execution_context>
@C:\Users\asvintheguy\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\asvintheguy\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-vault-ui-prompt-editor/04-CONTEXT.md
@.planning/phases/04-vault-ui-prompt-editor/04-RESEARCH.md
@.planning/phases/04-vault-ui-prompt-editor/04-01-SUMMARY.md
@src/lib/components/vault/VaultPanel.svelte
@src/lib/services/packs/pack-service.ts
@src/lib/services/packs/types.ts
@src/lib/components/vault/prompts/templateGroups.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PromptPackCard and CreatePackDialog components</name>
  <files>
    src/lib/components/vault/prompts/PromptPackCard.svelte
    src/lib/components/vault/prompts/CreatePackDialog.svelte
  </files>
  <action>
**PromptPackCard.svelte:**

Create a DISTINCT card design (not reusing VaultCard). Per user decisions:
- Card shows: pack name, description, modified template count, active indicator (badge if any story uses it)
- Default pack has "Default" badge
- Cards should be clickable (onclick prop for opening editor in next plan)

Props:
```typescript
interface Props {
  pack: PresetPack
  modifiedCount: number
  usageCount: number
  onclick: () => void
}
```

Use shadcn Card component. Layout:
- Top row: pack name + badges (Default badge if `pack.isDefault`, "Active" badge in green if `usageCount > 0`)
- Description line (if present, muted text)
- Bottom row: "{modifiedCount} modified" + author (or "Custom")
- The whole card is clickable with hover state (`hover:border-primary/50 transition-colors cursor-pointer`)
- Do NOT include favorite, tags, or image -- this is metadata-focused, not content-focused

**CreatePackDialog.svelte:**

Simple dialog for creating a new pack. Uses shadcn Dialog component.

Props:
```typescript
interface Props {
  open: boolean
  onOpenChange: (open: boolean) => void
  onCreated: (pack: PresetPack) => void
}
```

Dialog content:
- Text input for pack name (required, min 1 char)
- Textarea for description (optional)
- Text input for author (optional)
- Create button (calls `packService.createPack(name, description, author)`)
- On success, calls `onCreated` with the new pack and closes dialog

Import `packService` from `$lib/services/packs/pack-service`. Import types from `$lib/services/packs/types`.
  </action>
  <verify>
`npm run check` passes with both new components compiling.
  </verify>
  <done>PromptPackCard renders pack metadata with badges. CreatePackDialog creates packs via packService.</done>
</task>

<task type="auto">
  <name>Task 2: Create PromptPackList and integrate Prompts tab into VaultPanel</name>
  <files>
    src/lib/components/vault/prompts/PromptPackList.svelte
    src/lib/components/vault/VaultPanel.svelte
  </files>
  <action>
**PromptPackList.svelte:**

The browsing view for the Prompts tab. Shows a grid of PromptPackCard components.

Props:
```typescript
interface Props {
  onOpenPack: (packId: string) => void
}
```

Behavior:
- On mount, load packs via `packService.getAllPacks()`
- For each pack, load modified count via `packService.getModifiedTemplates(packId)` and count true values
- For each pack, load usage count via `database.getPackUsageCount(packId)`
- Sort: default pack first (pinned), then user-created packs by name
- Display as grid (same responsive pattern as existing vault: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3`)
- Show loading skeletons while data loads
- Empty state not needed (default pack always exists)

State:
```typescript
let packs = $state<PresetPack[]>([])
let modifiedCounts = $state<Map<string, number>>(new Map())
let usageCounts = $state<Map<string, number>>(new Map())
let loading = $state(true)
let showCreateDialog = $state(false)
```

Expose the `showCreateDialog` state so the parent can trigger it from the header New button.

After pack creation in dialog, refresh the pack list by re-calling the load function.

**VaultPanel.svelte integration:**

1. Import new components at top:
```typescript
import PromptPackList from './prompts/PromptPackList.svelte'
import { FileCode } from 'lucide-svelte'
```

2. Update the `VaultTab` type import usage -- note the type is already extended in ui.svelte.ts from Plan 01. The local type alias in VaultPanel.svelte (line 43) needs to match:
```typescript
type VaultTab = 'characters' | 'lorebooks' | 'scenarios' | 'prompts'
```

3. Update `TabsList` grid from `grid-cols-3` to `grid-cols-4`.

4. Add the Prompts tab trigger in the TabsList (after scenarios):
```svelte
<TabsTrigger value="prompts" class="flex items-center gap-2">
  <FileCode class="h-4 w-4" />
  <span class="hidden sm:inline">Prompts</span>
</TabsTrigger>
```
Note: No count badge for prompts tab (unlike other tabs which show item counts).

5. Add TabsContent for prompts tab after the `{#each sections}` block:
```svelte
<TabsContent
  value="prompts"
  class="m-0 flex-1 overflow-hidden p-0 outline-none data-[state=inactive]:hidden"
>
  <ScrollArea class="h-full">
    <div class="flex min-h-full flex-col px-4 pb-36 sm:pb-16">
      <PromptPackList onOpenPack={handleOpenPack} bind:showCreateDialog={showCreatePackDialog} />
    </div>
  </ScrollArea>
</TabsContent>
```

6. When `activeTab === 'prompts'`, the header right-side actions should show:
- A disabled "Import" button with tooltip "Available in Phase 5" (satisfies VLT-03 UI presence while deferring functionality per phase boundary decision). Use shadcn `Tooltip` wrapping a `Button` with `disabled` attribute. Import `Download` icon from lucide-svelte for the Import button.
- A "New Pack" button that sets `showCreatePackDialog = true`

For other tabs, keep existing behavior (Tags, Browse Online, Import, etc.).

For the Search and Filters section below the tab bar:
- Hide the entire search/filter area when `activeTab === 'prompts'` (per decision: no search/filter within template list)

7. Add state variable:
```typescript
let showCreatePackDialog = $state(false)
```

8. Add handler stub:
```typescript
function handleOpenPack(packId: string) {
  // Will be implemented in Plan 03 (editor view state)
  console.log('Open pack:', packId)
}
```

IMPORTANT: The Prompts tab does NOT use the existing `sections` config array pattern. It has its own dedicated rendering path because it doesn't follow the same search/filter/card pattern as characters/lorebooks/scenarios.
  </action>
  <verify>
1. `npm run check` passes
2. VaultPanel renders 4 tabs (Characters, Lorebooks, Scenarios, Prompts)
3. Prompts tab shows the PromptPackList component
4. The search/filter area is hidden when Prompts tab is active
5. Import button is visible but disabled with tooltip
  </verify>
  <done>
- Vault has 4 tabs, Prompts tab visible
- Default pack card always shown with "Default" badge
- New button creates packs via dialog
- Import button present but disabled with "Available in Phase 5" tooltip
- Pack cards show name, description, modified count, active badge
  </done>
</task>

</tasks>

<verification>
1. `npm run check` passes with all new components
2. VaultPanel.svelte includes 4 tabs in TabsList
3. PromptPackCard shows Default badge, Active badge, modified count
4. CreatePackDialog creates a pack and list refreshes
5. Search/filter area hidden for Prompts tab
6. Import button visible but disabled with tooltip
</verification>

<success_criteria>
- VLT-01: Vault has Prompts tab alongside Characters, Lorebooks, Scenarios
- VLT-02: Prompts tab shows cards for each preset pack
- VLT-03: Prompts tab has Import (disabled placeholder) and New buttons in top right
- EDT-10: Cards show modified template count
- PKG-03: User can create a new preset pack (copies defaults)
</success_criteria>

<output>
After completion, create `.planning/phases/04-vault-ui-prompt-editor/04-02-SUMMARY.md`
</output>
